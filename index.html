<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nota Pendidikan Islam</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons (deferred to prevent blocking) -->
    <script src="https://unpkg.com/lucide-icons"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Class to hide elements */
        .hidden {
            display: none;
        }
        /* Custom class for disabled quiz options */
        .kuiz-option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <!-- Main Container -->
    <div id="app-container" class="flex h-screen">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-white dark:bg-gray-800 text-gray-900 dark:text-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out z-30 shadow-lg">
            <a href="#" class="text-2xl font-extrabold px-4 flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-500" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.043 5.76a.75.75 0 011.213-.878l5.25 7.5a.75.75 0 01-1.044 1.26l-5.25-7.5a.75.75 0 01-.22-.382zM4.75 11.25a.75.75 0 01.75-.75h4a.75.75 0 010 1.5h-4a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
                </svg>
                <span>NotaPI</span>
            </a>

            <nav>
                <a href="#" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-teal-500 hover:text-white" data-page="utama">
                    <i data-lucide="home" class="inline-block w-5 h-5 mr-2"></i> Halaman Utama
                </a>
                <a href="#" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-teal-500 hover:text-white" data-page="nota-t1">
                    <i data-lucide="book-marked" class="inline-block w-5 h-5 mr-2"></i> Nota T1
                </a>
                <a href="#" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-teal-500 hover:text-white" data-page="nota-t2">
                    <i data-lucide="book-marked" class="inline-block w-5 h-5 mr-2"></i> Nota T2
                </a>
                <a href="#" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-teal-500 hover:text-white" data-page="nota-t3">
                    <i data-lucide="book-marked" class="inline-block w-5 h-5 mr-2"></i> Nota T3
                </a>
                <a href="#" class="nav-link block py-2.5 px-4 rounded transition duration-200 hover:bg-teal-500 hover:text-white" data-page="tentang">
                    <i data-lucide="info" class="inline-block w-5 h-5 mr-2"></i> Tentang Kami
                </a>
            </nav>

            <div class="absolute bottom-0 left-0 w-full p-2 border-t dark:border-gray-700">
                 <a href="#" id="login-register-btn" class="nav-link block w-full text-left py-2.5 px-4 rounded transition duration-200 hover:bg-teal-500 hover:text-white" data-page="login">
                    <i data-lucide="log-in" class="inline-block w-5 h-5 mr-2"></i> Login / Register
                </a>
                <a href="#" id="logout-btn" class="hidden w-full text-left block py-2.5 px-4 rounded transition duration-200 hover:bg-red-500 hover:text-white">
                    <i data-lucide="log-out" class="inline-block w-5 h-5 mr-2"></i> Logout
                </a>
            </div>
        </aside>

        <!-- Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="flex justify-between items-center p-4 bg-white dark:bg-gray-800 shadow-md z-10">
                 <div class="flex items-center">
                    <button id="header-back-btn" class="hidden p-2 rounded-full mr-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <button id="menu-btn" class="md:hidden">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <h1 id="page-title" class="text-xl font-semibold ml-2 md:ml-0">Halaman Utama</h1>
                </div>
                <div id="header-countdown" class="hidden sm:flex items-center text-sm font-semibold text-teal-600 dark:text-teal-400">
                    <i data-lucide="timer" class="w-4 h-4 mr-2"></i>
                    <span>Menuju Solat Seterusnya: <span id="header-countdown-timer">--:--:--</span></span>
                </div>
            </header>

            <main id="main-content" class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 dark:bg-gray-900 p-4 sm:p-6 lg:p-8">
                
                <!-- Page: Login/Register -->
                <div id="page-login" class="page">
                    <div class="max-w-md mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden">
                        <div class="p-8">
                            <!-- Login Form -->
                            <div id="login-form">
                                <h2 class="text-2xl font-bold text-center text-teal-500 mb-6">Selamat Kembali</h2>
                                <form id="form-login-submit">
                                    <div class="mb-4">
                                        <label for="login-username" class="block text-sm font-medium mb-2">Username</label>
                                        <input type="text" id="login-username" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                    </div>
                                    <div class="mb-6 relative">
                                        <label for="login-password" class="block text-sm font-medium mb-2">Password</label>
                                        <input type="password" id="login-password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer top-7" onclick="togglePasswordVisibility('login-password')">
                                            <i data-lucide="eye" class="w-5 h-5 text-gray-400"></i>
                                        </span>
                                    </div>
                                    <button type="submit" class="w-full bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600 transition duration-200 font-semibold">Login</button>
                                </form>
                                <p class="text-center mt-4 text-sm">
                                    Tiada akaun? <a href="#" id="show-register-form" class="text-teal-500 hover:underline">Daftar di sini</a>
                                </p>
                            </div>

                            <!-- Register Form (hidden by default) -->
                            <div id="register-form" class="hidden">
                                <h2 class="text-2xl font-bold text-center text-teal-500 mb-6">Buat Akaun Baru</h2>
                                <form id="form-register-submit">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <input type="text" id="register-username" placeholder="Username" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                        <input type="email" id="register-email" placeholder="Email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                    </div>
                                    <div class="mt-4 relative">
                                        <input type="password" id="register-password" placeholder="Password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                        <span class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer" onclick="togglePasswordVisibility('register-password')">
                                            <i data-lucide="eye" class="w-5 h-5 text-gray-400"></i>
                                        </span>
                                    </div>
                                    <div class="mt-4 relative">
                                        <input type="password" id="register-confirm-password" placeholder="Confirm Password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                    </div>
                                    <div class="mt-4">
                                        <input type="text" id="register-sekolah" placeholder="Sekolah" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                    </div>
                                    <div class="mt-4">
                                        <select id="register-tingkatan" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:border-gray-600" required>
                                            <option value="">Pilih Tingkatan</option>
                                            <option value="1">Tingkatan 1</option>
                                            <option value="2">Tingkatan 2</option>
                                            <option value="3">Tingkatan 3</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="w-full mt-6 bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600 transition duration-200 font-semibold">Register</button>
                                </form>
                                <p class="text-center mt-4 text-sm">
                                    Sudah ada akaun? <a href="#" id="show-login-form" class="text-teal-500 hover:underline">Login di sini</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page: Utama -->
                <div id="page-utama" class="page hidden">
                    <div id="guest-warning" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg mb-6" role="alert">
                        <p class="font-bold">Perhatian!</p>
                        <p>Anda melawat sebagai tetamu. Sila <a href="#" id="guest-login-link" class="font-bold underline">Login atau Register</a> untuk akses penuh.</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Waktu Solat -->
                        <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
                            <h2 class="text-2xl font-bold mb-4">Waktu Solat</h2>
                            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                                <select id="solat-negeri" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                                    <option>Pilih Negeri</option>
                                </select>
                                <select id="solat-kawasan" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                                    <option>Pilih Kawasan</option>
                                </select>
                            </div>
                            <div id="solat-results" class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                Sila pilih negeri dan kawasan untuk paparan waktu solat.
                            </div>
                        </div>

                        <!-- Pengenalan -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
                            <h2 class="text-2xl font-bold mb-4">Selamat Datang!</h2>
                            <p class="mb-4">
                                Portal Nota Pendidikan Islam ini menyediakan nota komprehensif, kuiz interaktif, dan papan mata untuk pelajar Tingkatan 1, 2, dan 3.
                            </p>
                            <p>
                                Misi kami adalah untuk menjadikan pembelajaran Pendidikan Islam lebih mudah diakses, menarik dan berkesan.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Pautan Nota -->
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <a href="#" class="nav-link bg-teal-500 text-white p-8 rounded-lg shadow-lg hover:bg-teal-600 transition text-center" data-page="nota-t1">
                            <i data-lucide="book-open" class="mx-auto w-12 h-12 mb-4"></i>
                            <h3 class="text-2xl font-bold">Nota Tingkatan 1</h3>
                        </a>
                        <a href="#" class="nav-link bg-blue-500 text-white p-8 rounded-lg shadow-lg hover:bg-blue-600 transition text-center" data-page="nota-t2">
                            <i data-lucide="book-open" class="mx-auto w-12 h-12 mb-4"></i>
                            <h3 class="text-2xl font-bold">Nota Tingkatan 2</h3>
                        </a>
                        <a href="#" class="nav-link bg-indigo-500 text-white p-8 rounded-lg shadow-lg hover:bg-indigo-600 transition text-center" data-page="nota-t3">
                            <i data-lucide="book-open" class="mx-auto w-12 h-12 mb-4"></i>
                            <h3 class="text-2xl font-bold">Nota Tingkatan 3</h3>
                        </a>
                    </div>
                </div>

                <!-- Page: Nota T1/T2/T3 (Template) -->
                <div id="page-nota" class="page hidden">
                    <h2 id="nota-title" class="text-3xl font-bold mb-6">Nota Tingkatan 1</h2>
                    <!-- Tabs -->
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <a href="#" class="tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-teal-500 text-teal-600" data-tab="nota-content">Nota</a>
                            <a href="#" class="tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200" data-tab="kuiz-content">Kuiz</a>
                            <a href="#" class="tab-link whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200" data-tab="leaderboard-content">Leaderboard</a>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div class="mt-6">
                        <div id="nota-content" class="tab-content">
                            <!-- Placeholder: Bidang and Tajuk will be loaded here -->
                            <div class="space-y-4" id="nota-list">
                                <p>Senarai nota akan dipaparkan di sini...</p>
                            </div>
                        </div>
                        <div id="kuiz-content" class="tab-content hidden">
                            <!-- Placeholder: List of quizzes -->
                            <div class="space-y-4" id="kuiz-list">
                                <p>Senarai kuiz akan dipaparkan di sini...</p>
                            </div>
                        </div>
                        <div id="leaderboard-content" class="tab-content hidden">
                           <!-- Placeholder: Leaderboard table -->
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-semibold mb-4">Ranking Pelajar</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">#</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Nama</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Skor</th>
                                            </tr>
                                        </thead>
                                        <tbody id="leaderboard-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                            <!-- Rows will be added dynamically -->
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">1</td>
                                                <td class="px-6 py-4 whitespace-nowrap">Ahmad_Cyber</td>
                                                <td class="px-6 py-4 whitespace-nowrap">980</td>
                                            </tr>
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">2</td>
                                                <td class="px-6 py-4 whitespace-nowrap">Siti_Pintar</td>
                                                <td class="px-6 py-4 whitespace-nowrap">950</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Page: Embed -->
                <div id="page-embed" class="page hidden h-full relative">
                    <iframe id="embed-frame" src="" frameborder="0" class="w-full h-full z-0" allowfullscreen></iframe>
                    <!-- Blocker for the pop-out button -->
                    <div class="absolute top-0 right-0 w-16 h-16 z-10"></div>
                </div>


                <!-- Page: Kuiz -->
                <div id="page-kuiz" class="page hidden">
                    <div class="max-w-2xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 id="kuiz-title" class="text-2xl font-bold">Kuiz: Akidah</h2>
                            <p id="kuiz-progress" class="font-semibold text-gray-600 dark:text-gray-300">Soalan 1 / 10</p>
                        </div>
                        <div class="mb-6">
                            <p class="text-lg" id="kuiz-question">Apakah Rukun Iman yang pertama?</p>
                        </div>
                        <div id="kuiz-options" class="space-y-3">
                            <button class="kuiz-option-btn w-full text-left p-4 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition">Percaya kepada Rasul</button>
                            <button class="kuiz-option-btn w-full text-left p-4 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition" data-correct="true">Percaya kepada Allah</button>
                            <button class="kuiz-option-btn w-full text-left p-4 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition">Percaya kepada Kitab</button>
                            <button class="kuiz-option-btn w-full text-left p-4 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition">Percaya kepada Hari Kiamat</button>
                        </div>
                        <div id="kuiz-feedback" class="mt-4 p-4 rounded-lg hidden font-medium text-center"></div>
                        <div class="flex justify-end mt-6">
                            <button id="next-kuiz-btn" class="bg-teal-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-teal-600 transition hidden">Seterusnya</button>
                        </div>
                    </div>
                </div>


                <!-- Page: Tentang Kami -->
                <div id="page-tentang" class="page hidden">
                    <div class="max-w-2xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl text-center">
                        <div class="w-32 h-32 rounded-full mx-auto mb-4 overflow-hidden relative bg-gray-200">
                             <img src="https://lh3.googleusercontent.com/d/1-VhGUFMv0XAFNQ_I0_slos7RmaWQRGSD" alt="Mohammad Saiful bin Abdul Samat" class="absolute w-full h-full object-cover" style="top: 0;">
                        </div>
                        <h2 class="text-3xl font-bold">Mohammad Saiful bin Abdul Samat</h2>
                        <p class="text-teal-500 font-medium">Guru Pendidikan Islam SMKKS</p>
                        <div class="mt-6 text-left max-w-md mx-auto space-y-4 text-gray-700 dark:text-gray-300">
                           <div>
                                <strong class="font-semibold text-gray-900 dark:text-white">Pengalaman:</strong>
                                <p>6 tahun mengajar Pendidikan Islam</p>
                           </div>
                           <div>
                                <strong class="font-semibold text-gray-900 dark:text-white">Pendidikan:</strong>
                                <ul class="list-disc list-inside ml-2">
                                    <li>Sarjana Muda Pendidikan (Pengajian Islam), Universiti Malaya</li>
                                    <li>Sarjana Pendidikan Islam, Universiti Kebangsaan Malaysia</li>
                                </ul>
                           </div>
                           <div>
                                <strong class="font-semibold text-gray-900 dark:text-white">Email:</strong>
                                <p><a href="mailto:g-67503298@moe-dl.edu.my" class="text-teal-500 hover:underline">g-67503298@moe-dl.edu.my</a></p>
                           </div>
                        </div>
                        <div class="mt-8">
                            <a href="https://facebook.com/saifulsamat142" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition">
                                <i data-lucide="facebook" class="w-5 h-5 mr-2"></i>
                                Follow di FB untuk Tutorial Inovasi
                            </a>
                        </div>
                    </div>
                </div>


                <!-- Pop-up/Modal for notifications -->
                <div id="popup-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-2xl max-w-sm text-center">
                        <h3 id="popup-title" class="text-xl font-bold mb-4">Notifikasi</h3>
                        <p id="popup-message"></p>
                        <button id="popup-close" class="mt-6 bg-teal-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-teal-600">Tutup</button>
                    </div>
                </div>

            </main>
        </div>
    </div>
    
    <script type="module">
        // Firebase Imports - will be used when you set up your project
        // import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        // import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        // import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // IMPORTANT: Replace this with your actual Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase (uncomment when ready)
        // const app = initializeApp(firebaseConfig);
        // const auth = getAuth(app);
        // const db = getFirestore(app);

        // --- App State ---
        let currentPage = 'login';
        let currentUser = null;
        let currentTingkatan = 1;
        let prayerTimesToday = null;
        let countdownInterval = null;


        // --- UI Elements ---
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const sidebarNavLinks = document.querySelectorAll('#sidebar nav a.nav-link, #login-register-btn'); // For highlighting active state
        const pageTitle = document.getElementById('page-title');
        const sidebar = document.getElementById('sidebar');
        const menuBtn = document.getElementById('menu-btn');
        const headerBackBtn = document.getElementById('header-back-btn');
        const loginRegisterBtn = document.getElementById('login-register-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const guestWarning = document.getElementById('guest-warning');
        const mainContent = document.getElementById('main-content');


        // --- Mock Data ---
        const notaData = {
            1: {
                "Bidang al-Quran": [
                    { title: "Mukmin Yang Bertaqwa", url: "https://drive.google.com/file/d/1iJgD1JnTY9hpHCgTW6wGOKHiWjbVY0La/preview" },
                    { title: "Memohon Kebahagiaan Hakiki", url: "https://drive.google.com/file/d/17VacaYdVJ6RFS_rxN5Pwl9z4w9fhXD_t/preview" },
                    { title: "Maha Suci Allah", url: "https://drive.google.com/file/d/1pAyHQWYOgGuAqF57TBNU7bAe_5QrHIMZ/preview" },
                    { title: "Allah SWT Penguasa Mutlak", url: "https://drive.google.com/file/d/1W24OsSwU-wMeKRgzl-85xJ-DOQ9Ex78M/preview" },
                    { title: "Indahnya Tajwid", url: "https://drive.google.com/file/d/16gxaxMn-cym0YFAFl7LLt4spKlTsvJKm/preview" },
                    { title: "Segala Puji Bagi Allah", url: "https://drive.google.com/file/d/1dcR-MClnBEoFWnvWJKd-YIbFU3i-bvYg/preview" },
                    { title: "Iblis Dan Syaitan Yang Durjana", url: "https://drive.google.com/file/d/1PGKNNJpcIfozRPeogNOOYvajwDTKSd--/preview" },
                    { title: "Sabar Menghadapi Dugaan Hidup", url: "https://drive.google.com/file/d/11E8_YA817xFkE8n7tdOHPgEhcxxfoW1e/preview" },
                    { title: "Makanan Halal Lagi Baik", url: "https://drive.google.com/file/d/1CfE_jxIvBcePP6xl5MXt8-XfVG-K92gO/preview" }
                ],
                "Bidang Hadith": [
                    { title: "Hadith Sumber Hukum", url: "https://drive.google.com/file/d/1qa23k0YCRolnCubUhjqPa9feICTwO4wH/preview" },
                    { title: "Ikhlas Dalam Kehidupan", url: "https://drive.google.com/file/d/1PXQgZx2q5JkK1eNz6RKBdGTjhVN6wZkd/preview" },
                    { title: "Jihad Dalam Islam", url: "https://drive.google.com/file/d/16ohBlbJSkfInmgsU1xwUje1hhKAL3mfE/preview" }
                ],
                "Bidang Aqidah": [
                    { title: "Islam Agama Fitrah", url: "https://drive.google.com/file/d/1iFQCUp-Of925JX-vMmsYE1e-be0jRZaS/preview" },
                    { title: "Aqidah Islam", url: "https://drive.google.com/file/d/1qD9sV4lCqi5G0Ifl7L5mZveTnC03vsHX/preview" },
                    { title: "Beriman Kepada Allah SWT", url: "https://drive.google.com/file/d/1KQYS5Q7YdMsFVd_79B9dNAKhydvCA6_n/preview" },
                    { title: "al-Khaliq dan al-Musawwir", url: "https://drive.google.com/file/d/1lhCCB RnZk8cHbSh5-OQ_vgTXCR0FaqzG/preview" }
                ],
                "Bidang Ibadah": [
                    { title: "Konsep Ibadah dan Jenis Hukum", url: "https://drive.google.com/file/d/1U5vc9SgwdJKUFD928ukmN7lU7Dej7678/preview" },
                    { title: "Bersuci Asas Kebersihan", url: "https://drive.google.com/file/d/1vsvVm3KjqeNkbe94abZeeiQDUXS5YEXp/preview" },
                    { title: "Bersuci Daripada Najis", url: "https://drive.google.com/file/d/1EBlsRJ1_62gCRy9DCnYorzS-UfCk6Z8k/preview" },
                    { title: "Istinjak Suatu Tuntutan", url: "https://drive.google.com/file/d/1arkxagn8zTFyyvCwbZRyWZykdEb2-1Qt/preview" },
                    { title: "Wudhuk Dan Syarat Kesempurnaannya", url: "https://drive.google.com/file/d/14XBZHhST7ASGy3BGCRiT6IwXdGh2XTrG/preview" },
                    { title: "Mandi Wajib Penyuci Diri", url: "https://drive.google.com/file/d/1uWeThLeX1oDu9eGP9MaqhEy0WqDxdZU4/preview" },
                    { title: "Solat Mercu Kejayaan", url: "https://drive.google.com/file/d/1QAOsHdzVbcfs0by0H73Up7yWTKXwJk_n/preview" }
                ],
                "Bidang Sirah": [
                    { title: "Riwayat Hidup Nabi Muhammad SAW", url: "https://drive.google.com/file/d/1cLmh4bMeF1TVX6RPKFC2GKQKXlAVHjDP/preview" },
                    { title: "Era Masyarakat Jahiliyyah", url: "https://drive.google.com/file/d/1kenevynYyYXnFEXKgOrQWvTm21V2bgm0/preview" },
                    { title: "Keunggulan Perjuangan Khulafa' ar-Rasyidin", url: "https://drive.google.com/file/d/1gEdo0aNljaB7GO0ROtFsGeA7ZozntLqb/preview" }
                ],
                "Bidang Akhlak": [
                    { title: "Akhlak Terpuji Hiasan Diri", url: "https://drive.google.com/file/d/10HEgAxj6QYGvBjkUqcxl2MRXZQn24Cpm/preview" },
                    { title: "Amanah Tonggak Kesejahteraan", url: "https://drive.google.com/file/d/1eyP_RfY1V1GOprrTLajVjySrrDfIuRGm/preview" },
                    { title: "Ilmu Cahaya Kehidupan", url: "https://drive.google.com/file/d/1i-fLa68oq0y-CM1xo_KIjhjVM3sZKXYn/preview" },
                    { title: "Maruah Diri Cerminan Peribadi", url: "https://drive.google.com/file/d/1A4Cq3zqSBU_s7DoX_72zhAlOIwJCPRw8/preview" }
                ]
            },
            2: {
                "Bidang Al-Quran": [
                    { title: "Allah SWT Pengurnia Hidayah", url: "https://drive.google.com/file/d/1xu5zagC0t_RB0HUp86qVJoYhnK7PnEfP/preview" },
                    { title: "Hanya Allah SWT Yang Maha Esa", url: "https://drive.google.com/file/d/1U_No7PIG9XApM3ERIymFMIA_HgOgrmZO/preview" },
                    { title: "Luasnya Kuasa Allah SWT", url: "https://drive.google.com/file/d/1GduYOrXCRD1lRTefpzlbUJrv6YlWqrLO/preview" },
                    { title: "Mudahnya Tajwid", url: "https://drive.google.com/file/d/10ZRsUvHP0B0zHOGNN7DvRjA44DHjXWhe/preview" },
                    { title: "Manisnya Persaudaraan", url: "https://drive.google.com/file/d/1Luew73xzkXv9cHbtISKRCwMpZI7QZwZc/preview" },
                    { title: "Mengharap Keampunan Allah", url: "https://drive.google.com/file/d/1k6_fyrI4TCLU_zSqZqLhSyVz0fxyJN_u/preview" },
                    { title: "Kesantunan Dakwah Rasulullah SAW", url: "https://drive.google.com/file/d/1UVHnbffsitMTWoQKLz2REGgrpv3HK1jS/preview" },
                    { title: "Amanah Terhadap Harta dan Nyawa", url: "https://drive.google.com/file/d/19OyYxb328G4zKOsP-VUy9C_AwYDmGrQa/preview" }
                ],
                "Bidang Hadith": [
                    { title: "Mungkar Dicegah Hidup Berkah", url: "https://drive.google.com/file/d/1sXXaKGvAeggGbVDNR3HNZv_ngadL-M6g/preview" },
                    { title: "Mencari Yang Halal", url: "https://drive.google.com/file/d/1PRCGfOmS1yIbkwcanSSmhbl79rNP75q6/preview" }
                ],
                "Bidang Aqidah": [
                    { title: "Kekuatan dan Kekuasaan Allah SWT", url: "https://drive.google.com/file/d/1Bz0MTjJ6yjUbiO30ccS1zwKartHVFR1P/preview" },
                    { title: "Ketaatan Malaikat", url: "https://drive.google.com/file/d/1ma7vGKQKkBBppBq13pWU9N6NbrxrHFid/preview" },
                    { title: "Panduan Daripada Allah SWT", url: "https://drive.google.com/file/d/1_7MxGVlKF5H0m9-1EXKp6MVUmSQckPDe/preview" },
                    { title: "Solat Berjemaah Pengikat Hati", url: "https://drive.google.com/file/d/1ZAiNCiArTxED6tpJ873MB_KYzzFKf98s/preview" }
                ],
                "Bidang Ibadah": [
                    { title: "Solat Jumaat Wadah Kesatuan", url: "https://drive.google.com/file/d/1EmA8Zc9cumv-SqLv-PDrB1Xkas2yHi9d/preview" },
                    { title: "Tamayammum Dengan Debu Suci", url: "https://drive.google.com/file/d/1YnTiLVV2X5NN-cqTXbkSL8PN6O4md9hP/preview" },
                    { title: "Rukhsah Anugerah Daripada Allah SWT", url: "https://drive.google.com/file/d/1RJL5-NxjUq_vdjMIMkzD6RM6KsXeYoVu/preview" },
                    { title: "Puasa Benteng Diri", url: "https://drive.google.com/file/d/1XxCvkGdqvE0iNpvM8E8w_nTwd5x0i-gw/preview" },
                    { title: "Solat Sunat Menampung Kefardhuan", url: "https://drive.google.com/file/d/13V3DTEJAUw6enODElk5wlBoswmjoqyi2/preview" }
                ],
                "Bidang Sirah": [
                    { title: "Terbitnya Fajar Dakwah", url: "https://drive.google.com/file/d/1O-6dT0qQCJR42UEPjzLTpwjB3AUwc4Ib/preview" },
                    { title: "Hijrah Detik Bersejarah", url: "https://drive.google.com/file/d/12oSNuR7aOIsEgwhJrsIpmqMDza_6izf6/preview" },
                    { title: "Kepimpinan Rasulullah SAW di Madinah", url: "https://drive.google.com/file/d/1386jSqlT7-QBDUgkQOTlu8Qo3-_QjHXz/preview" },
                    { title: "Wanita Suri Teladan Umat", url: "https://drive.google.com/file/d/1RLEn4IjkGZHb6bNlLBnaXYduGBpmSyhN/preview" }
                ],
                "Bidang Akhlak": [
                    { title: "Malu Perisai Iman", url: "https://drive.google.com/file/d/14-e3lafjherV455kRCNGp30X8zcstUDk/preview" },
                    { title: "Menyemai Kasih Menuai Sayang", url: "https://drive.google.com/file/d/1E5Z3B3iqDnGlqyM-zWyMfM3vChodpgs0/preview" },
                    { title: "Muliakan Ibu Bapa Bahagiakan Keluarga", url: "https://drive.google.com/file/d/1-F4o1RnE_fFwgDWNWecPpoH0wUwHIEx9/preview" },
                    { title: "Santuni Jiranmu", url: "https://drive.google.com/file/d/10ogj7Y9J1nME_ZNXCVr5Th8SgKxs5TJB/preview" },
                    { title: "Masjid Destinasiku", url: "https://drive.google.com/file/d/1Zg0Ikody4QR_8y04tLmlu88wqXLmtvFW/preview" }
                ]
            },
            3: {
                "Bidang al-Quran": [
                    { title: "Allah SWT Pengampun Segala Dosa", url: "https://drive.google.com/file/d/12U_3Y-hT9dzzTRp0_cU5Qd-sALlFfHkd/preview" },
                    { title: "al-Quran Petunjuk Kebenaran", url: "https://drive.google.com/file/d/14CJJE0zo2TW6YapFA9i04FD0amo09Ek6/preview" },
                    { title: "Hukum Tajwid", url: "https://drive.google.com/file/d/1o3v3Z3YuN8XF0jkRvR2Fg6S7HROzq6aN/preview" },
                    { title: "Pancaindera Yang Dimanfaatkan", url: "https://drive.google.com/file/d/14v4yskCyKxiwZmEZRG63lVdeaXHKd68d/preview" },
                    { title: "Zikir Penenang Hati", url: "https://drive.google.com/file/d/1Zp89X-PxzFP0-q8iDxAzVV4yLVVrGQEV/preview" },
                    { title: "Generasi Unggul", url: "https://drive.google.com/file/d/1Pq0IRa996rOZtL_tupMn8I-bhAckr22r/preview" },
                    { title: "Kewajipan Memelihara Kehormatan Diri", url: "https://drive.google.com/file/d/1xz4BAU-0jcsBrgQyiZypuj3MGDc_vSGj/preview" },
                    { title: "Penciptaan Manusia Bukti Kekuasaan Allah SWT", url: "https://drive.google.com/file/d/191bdQ2leNIJoBpChx1VMPHB27zWc8wxE/preview" }
                ],
                "Bidang Hadith": [
                    { title: "Sedekah Kunci Kebaikan", url: "https://drive.google.com/file/d/14XATZTtDyz4hhOJzA4JyjxOC81h8Fd3O/preview" },
                    { title: "Hindari Sifat Negatif", url: "https://drive.google.com/file/d/1c2DPg9QHyjSKPGwcH9XZWB9QbkYa2HFQ/preview" }
                ],
                "Bidang Aqidah": [
                    { title: "Allah SWT Maha Kaya Pengurnia Rezeki", url: "https://drive.google.com/file/d/13MNLeFwCc8RX4v0AzsECArNFJJ19KRF8/preview" },
                    { title: "Beriman Kepada Rasul", url: "https://drive.google.com/file/d/1C2Bp13iAAw-xKEoLy2FhwVy4XmdUsEK3/preview" },
                    { title: "Beriman Kepada Hari Akhirat", url: "https://drive.google.com/file/d/10-0nq3CkmyixpW0rMnGr33hfJlI-5SWm/preview" },
                    { title: "Beriman Kepada Qada' dan Qadar", url: "https://drive.google.com/file/d/1pIm1gW8zLuFhDYOSYK2Su8h2rEYOLiHB/preview" }
                ],
                "Bidang Ibadah": [
                    { title: "Konsep Fardhu Ain Dan Fardhu Kifayah", url: "https://drive.google.com/file/d/1hx78_zeUATpn2Ms-1V51MOMCllg2duQp/preview" },
                    { title: "Pengurusan Jenazah", url: "https://drive.google.com/file/d/1fIzcDYb1ATbeCXKiWaMYW7VzIVqeK4nO/preview" },
                    { title: "Zakat Penyuci Harta", url: "https://drive.google.com/file/d/14Lf8dGlgwJOJCdqusBrjwjprsvwtpoC_/preview" },
                    { title: "Aidilfitri Dan Aidiladha", url: "https://drive.google.com/file/d/1Y0kYIXJSD29B6rMMVSLpoaO5SP4A9-5U/preview" },
                    { title: "Qiamullail Pemangkin Kekuatan Jiwa", url: "https://drive.google.com/file/d/14TbrNNQphl9rYugK1fzZ-VoT5uD-jMQr/preview" },
                    { title: "Solat Sunat Tahiyyatul Masjid Dan Solat Sunat Hajat", url: "https://drive.google.com/file/d/1N-p2Sov9MKy9K3e6RYhgqNh-9tCqqPH9/preview" }
                ],
                "Bidang Sirah": [
                    { title: "Perjanjian Hudaibiyyah Dan Pembukaan Kota Mekah", url: "https://drive.google.com/file/d/1aWMd76X0qSkhjoyV1uTJ4uQTlYHR0FFi/preview" },
                    { title: "Tokoh Sahabat", url: "https://drive.google.com/file/d/1NwJofuKJ5viXrq9e6QDKIr4f9KImPyNR/preview" }
                ],
                "Bidang Akhlak": [
                    { title: "Pemaaf Melunakkan Hati", url: "https://drive.google.com/file/d/1g9eQ5stv5X08-hpc2f58bByeVGiea7g8/preview" },
                    { title: "Qana'ah Hiasan Peribadi", url: "https://drive.google.com/file/d/1vCwPowSPZ7nuJ34StFxmMgZiCSvuZ93N/preview" },
                    { title: "Syukur Penyubur Iman", url: "https://drive.google.com/file/d/1tjqIagQWLGYYxkj5v6HFbqarlQ6CymeS/preview" },
                    { title: "Adab Berkomunikasi", url: "https://drive.google.com/file/d/1yYyCpBa7g9-1Nc_mudBbdhG14UFRubYa/preview" },
                    { title: "Adab Bermusafir", url: "https://drive.google.com/file/d/1s4EmWTdDzkEBMXn3CulqFsK_6i8fOmiy/preview" }
                ]
            }
        };

        const kuizData = {
            1: {
                "Bidang al-Quran": [
                    { title: "Mukmin Yang Bertakwa" }, { title: "Memohon Kebahagiaan Hakiki" }, { title: "Maha Suci Allah SWT" }, { title: "Allah SWT Penguasa Mutlak" }, { title: "Indahnya Tajwid" }, { title: "Segala Puji Bagi Allah SWT" }, { title: "Iblis & Syaitan Yang Durjana" }, { title: "Sabar Menghadapi Dugaan Kehidupan" }, { title: "Makanan Halal Lagi Baik" }
                ],
                "Bidang Hadith": [
                    { title: "Hadis Sumber Hukum" }, { title: "Ikhlas Dalam Kehidupan" }, { title: "Jihad Dalam Islam" }
                ],
                "Bidang Aqidah": [
                    { title: "Islam Agama Fitrah" }, { title: "Akidah Islam" }, { title: "Beriman Kepada Allah SWT" }, { title: "al-Khaliq dan al-Musawwir" }
                ],
                "Bidang Ibadah": [
                    { title: "Konsep Ibadah dan Jenis Hukum" }, { title: "Bersuci Asas Kebersihan" }, { title: "Suci Daripada Najis" }, { title: "Istinjak Suatu Tuntutan" }, { title: "Wuduk & Syarat Kesempurnaan" }, { title: "Mandi Wajib Penyuci Diri" }, { title: "Solat Mercu Kejayaan" }
                ],
                "Bidang Sirah": [
                    { title: "Riwayat Hidup Nabi Muhammad SAW" }, { title: "Era Masyarakat Jahiliah" }, { title: "Keunggulan Perjuangan Khulafa ar-Rasyidin" }
                ],
                "Bidang Akhlak": [
                    { title: "Akhlak Terpuji Hiasan Diri" }, { title: "Amanah Tunggak Kesejahteraan" }, { title: "Ilmu Cahaya Kehidupan" }, { title: "Maruah Diri Cerminan Peribadi" }
                ]
            },
            2: {
                 "Bidang Al-Quran": [
                    { title: "Allah SWT Pengurnia Hidayah" }, { title: "Hanya Allah SWT Yang Maha Esa" }, { title: "Luasnya Kuasa Allah SWT" }, { title: "Mudahnya Tajwid" }, { title: "Manisnya Persaudaraan" }, { title: "Mengharap Keampunan Allah SWT" }, { title: "Kesantunan Dakwah Rasulullah SAW" }, { title: "Amanah Terhadap Harta Dan Nyawa" }
                ],
                "Bidang Hadith": [
                    { title: "Mungkar Dicegah Hidup Berkat" }, { title: "Mencari Yang Halal" }
                ],
                "Bidang Aqidah": [
                    { title: "Kekuatan Dan Kekuasaan Allah SWT" }, { title: "Ketaatan Malaikat" }, { title: "Panduan Daripada Allah SWT" }, { title: "Solat Berjemaah Pengikat Hati" }
                ],
                "Bidang Ibadah": [
                    { title: "Solat Jumaat Wadah Kesatuan" }, { title: "Tayamum Dengan Debu Suci" }, { title: "Rukhsah Anugerah Allah SWT" }, { title: "Puasa Benteng Diri" }, { title: "Solat Sunat Menampung Kefarduan" }
                ],
                "Bidang Sirah": [
                    { title: "Terbitnya Fajar Dakwah" }, { title: "Hijrah Detik Bersejarah" }, { title: "Kepimpinan Rasulullah SAW Di Madinah" }, { title: "Wanita Suri Teladan Umat" }
                ],
                "Bidang Akhlak": [
                    { title: "Malu Perisai Iman" }, { title: "Menyemai Kasih Menuai Sayang" }, { title: "Muliakan Ibu Bapa Bahagiakan Keluarga" }, { title: "Santuni Jiranmu" }, { title: "Masjid Destinasiku" }
                ]
            },
            3: {
                "Bidang al-Quran": [
                    { title: "Allah SWT Pengampun Segala Dosa" }, { title: "Al Quran Petunjuk Kebenaran" }, { title: "Hukum Tajwid" }, { title: "Pancaindera Yang Dimanfaatkan" }, { title: "Zikir Penenang Hati" }, { title: "Generasi Unggul" }, { title: "Kewajipan Memelihara Kehormatan Diri" }, { title: "Penciptaan Manusia Bukti Kekuasaan Allah SWT" }
                ],
                "Bidang Hadith": [
                    { title: "Sedekah Kunci Kebaikan" }, { title: "Hindari Sifat Negatif" }
                ],
                "Bidang Aqidah": [
                    { title: "Allah SWT Maha Kaya Pengurnia Rezeki" }, { title: "Beriman Kepada Rasul" }, { title: "Beriman Kepada Hari Akhirat" }, { title: "Beriman Kepada Qadha Dan Qadar" }
                ],
                "Bidang Ibadah": [
                    { title: "Konsep Fardhu Ain Dan Fardhu Kifayah" }, { title: "Pengurusan Jenazah" }, { title: "Zakat Penyuci Harta" }, { title: "Aidilfitri Dan Aidiladha" }, { title: "Qiamulail Pemangkin Kekuatan Jiwa" }, { title: "Solat Sunat Tahiyatul Masjid Dan Solat Sunat Hajat" }
                ],
                "Bidang Sirah": [
                    { title: "Perjanjian Hudaibiyah Dan Pembukaan Kota Mekah" }, { title: "Tokoh Sahabat" }
                ],
                "Bidang Akhlak": [
                    { title: "Pemaaf Melunakkan Hati" }, { title: "Qanaah Hiasan Peribadi" }, { title: "Syukur Penyubur Iman" }, { title: "Adab Berkomunikasi" }, { title: "Adab Bermusafir" }
                ]
            }
        };


        // --- Helper Functions ---
        /**
         * Safely creates icons using Lucide.
         * This function checks if Lucide is available before using it.
         */
        function renderIcons() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // --- Navigation ---
        function showPage(targetPageId) {
            let containerPageId = targetPageId;
            let activeMenuId = targetPageId;

            // Special handling for nota pages
            if (targetPageId.startsWith('nota-t')) {
                currentTingkatan = parseInt(targetPageId.split('-t')[1]);
                displayNotaContent(currentTingkatan);
                displayKuizContent(currentTingkatan);
                containerPageId = 'nota';
            }
            
            // Keep nota menu active on sub-pages like embed or kuiz
            if (containerPageId === 'embed' || containerPageId === 'kuiz') {
                activeMenuId = `nota-t${currentTingkatan}`;
            }

            pages.forEach(page => page.classList.add('hidden'));
            const newPage = document.getElementById(`page-${containerPageId}`);
            if (newPage) {
                newPage.classList.remove('hidden');
                currentPage = containerPageId;
                updatePageTitle(containerPageId);
            }

            // Highlight active link in the sidebar
            sidebarNavLinks.forEach(link => {
                link.classList.remove('bg-teal-500', 'text-white');
                if (link.dataset.page === activeMenuId) {
                    link.classList.add('bg-teal-500', 'text-white');
                }
            });
            
            // Toggle header buttons and main content padding
            if (containerPageId === 'embed') {
                headerBackBtn.classList.remove('hidden');
                menuBtn.classList.add('hidden');
                mainContent.classList.remove('p-4', 'sm:p-6', 'lg:p-8');
            } else {
                 if (containerPageId === 'kuiz'){
                    headerBackBtn.classList.remove('hidden');
                    menuBtn.classList.add('hidden');
                 } else {
                    headerBackBtn.classList.add('hidden');
                    menuBtn.classList.remove('hidden');
                 }
                mainContent.classList.add('p-4', 'sm:p-6', 'lg:p-8');
            }

            // Close sidebar on mobile after navigation
            if (window.innerWidth < 768) {
                sidebar.classList.add('-translate-x-full');
            }
        }

        function updatePageTitle(pageId) {
            const titles = {
                login: 'Login / Register',
                utama: 'Halaman Utama',
                nota: `Nota Tingkatan ${currentTingkatan}`,
                embed: 'Paparan Nota',
                kuiz: 'Kuiz',
                tentang: 'Tentang Kami',
            };
            pageTitle.textContent = titles[pageId] || 'Nota Pendidikan Islam';
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = link.dataset.page;
                showPage(pageId);
            });
        });

        headerBackBtn.addEventListener('click', () => {
             showPage(`nota-t${currentTingkatan}`);
        });

        // Specific listener for the link inside the guest warning
        document.getElementById('guest-login-link')?.addEventListener('click', (e) => {
            e.preventDefault();
            showPage('login');
        });

        // --- Authentication UI Logic ---
        function updateAuthUI(user) {
            currentUser = user;
            if (user) {
                loginRegisterBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                guestWarning.classList.add('hidden');
                if(currentPage === 'login') showPage('utama');
            } else {
                loginRegisterBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                guestWarning.classList.remove('hidden');
                showPage('login');
            }
        }

        // Initially, assume logged out
        updateAuthUI(null);

        // --- Firebase Auth Handlers (placeholder functions) ---
        // onAuthStateChanged(auth, user => { updateAuthUI(user); });

        document.getElementById('form-register-submit').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const sekolah = document.getElementById('register-sekolah').value;
            const tingkatan = document.getElementById('register-tingkatan').value;

            if (password !== confirmPassword) {
                showPopup('Error', 'Password tidak sepadan.');
                return;
            }

            console.log('Registering user...', { username, email, sekolah, tingkatan });
            // try {
            //     const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            //     const user = userCredential.user;
            //     await setDoc(doc(db, "users", user.uid), {
            //         username, sekolah, tingkatan, email
            //     });
            showPopup('Berjaya!', 'Akaun anda telah berjaya didaftarkan. Sila login. Ambil screenshot maklumat anda untuk rujukan.');
            switchBetweenAuthForms('login');
            // } catch (error) {
            //     showPopup('Error', error.message);
            // }
        });

        document.getElementById('form-login-submit').addEventListener('submit', async (e) => {
            e.preventDefault();
            // const email = document.getElementById('login-username').value; // Using email for auth
            // const password = document.getElementById('login-password').value;
            console.log('Logging in...');
            // try {
            //     await signInWithEmailAndPassword(auth, email, password);
            //     // onAuthStateChanged will handle the redirect
            // } catch (error) {
            //     showPopup('Error', error.message);
            // }
            // Mock login success
            updateAuthUI({ uid: 'mock_user_id', email: 'user@example.com' });
        });

        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            console.log('Logging out...');
            // await signOut(auth);
            // Mock logout
            updateAuthUI(null);
        });

        // --- Form Utils ---
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                input.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            renderIcons();
        }
        window.togglePasswordVisibility = togglePasswordVisibility;

        function switchBetweenAuthForms(formToShow) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            if (formToShow === 'register') {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
            } else {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            }
        }
        document.getElementById('show-register-form').addEventListener('click', (e) => { e.preventDefault(); switchBetweenAuthForms('register'); });
        document.getElementById('show-login-form').addEventListener('click', (e) => { e.preventDefault(); switchBetweenAuthForms('login'); });


        // --- Nota Page Logic ---
        function displayNotaContent(tingkatan) {
            document.getElementById('nota-title').textContent = `Nota Tingkatan ${tingkatan}`;
            const notaContainer = document.getElementById('nota-list');
            notaContainer.innerHTML = '';
            const data = notaData[tingkatan] || {};

            if (Object.keys(data).length === 0) {
                notaContainer.innerHTML = '<p>Nota untuk tingkatan ini belum tersedia.</p>';
                return;
            }

            for (const bidang in data) {
                // Create a heading for the Bidang
                const bidangHeading = document.createElement('h3');
                bidangHeading.className = 'text-xl font-bold mt-6 mb-3 text-teal-600 dark:text-teal-400 border-b border-gray-300 dark:border-gray-600 pb-2';
                bidangHeading.textContent = bidang;
                notaContainer.appendChild(bidangHeading);
                
                // Create a container for the topics
                const tajukList = document.createElement('div');
                tajukList.className = 'space-y-2';

                // Add each topic link
                data[bidang].forEach(tajuk => {
                    const tajukLink = document.createElement('a');
                    tajukLink.href = '#';
                    tajukLink.className = 'block p-3 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition shadow-sm';
                    tajukLink.textContent = tajuk.title;
                    tajukLink.onclick = (e) => {
                        e.preventDefault();
                        showEmbedPage(tajuk.url);
                    };
                    tajukList.appendChild(tajukLink);
                });
                
                notaContainer.appendChild(tajukList);
            }
            renderIcons(); // Rerender icons if any were added
        }

        // --- Kuiz Page Logic ---
        function displayKuizContent(tingkatan) {
            const kuizContainer = document.getElementById('kuiz-list');
            kuizContainer.innerHTML = '';
            const data = kuizData[tingkatan] || {};

            if (Object.keys(data).length === 0) {
                kuizContainer.innerHTML = '<p>Kuiz untuk tingkatan ini belum tersedia.</p>';
                return;
            }

            for (const bidang in data) {
                const bidangHeading = document.createElement('h3');
                bidangHeading.className = 'text-xl font-bold mt-6 mb-3 text-teal-600 dark:text-teal-400 border-b border-gray-300 dark:border-gray-600 pb-2';
                bidangHeading.textContent = bidang;
                kuizContainer.appendChild(bidangHeading);
                
                const tajukList = document.createElement('div');
                tajukList.className = 'space-y-2';

                data[bidang].forEach(tajuk => {
                    const tajukLink = document.createElement('a');
                    tajukLink.href = '#';
                    tajukLink.className = 'flex justify-between items-center p-3 rounded-lg bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition shadow-sm';
                    tajukLink.innerHTML = `<span>${tajuk.title}</span><i data-lucide="play-circle" class="w-5 h-5 text-gray-400"></i>`;
                    tajukLink.onclick = (e) => {
                        e.preventDefault();
                        showKuizPage(tajuk.title);
                    };
                    tajukList.appendChild(tajukLink);
                });
                
                kuizContainer.appendChild(tajukList);
            }
            renderIcons();
        }

        function showKuizPage(title) {
            document.getElementById('kuiz-title').textContent = `Kuiz: ${title}`;
            resetKuizUI();
            showPage('kuiz');
        }

        function resetKuizUI() {
            const feedbackEl = document.getElementById('kuiz-feedback');
            const nextBtn = document.getElementById('next-kuiz-btn');
            const optionButtons = document.querySelectorAll('.kuiz-option-btn');
            
            feedbackEl.classList.add('hidden');
            nextBtn.classList.add('hidden');
            
            optionButtons.forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('bg-green-500', 'text-white', 'border-green-500', 'bg-red-500', 'border-red-500');
                btn.classList.add('border-gray-300', 'dark:border-gray-600', 'hover:bg-gray-100', 'dark:hover:bg-gray-700');
            });
        }
        
        function setupKuizInteraction() {
            const optionsContainer = document.getElementById('kuiz-options');
            const feedbackEl = document.getElementById('kuiz-feedback');
            const nextBtn = document.getElementById('next-kuiz-btn');

            optionsContainer.addEventListener('click', (e) => {
                const clickedBtn = e.target.closest('.kuiz-option-btn');
                if (!clickedBtn || clickedBtn.disabled) return;

                const allOptionBtns = optionsContainer.querySelectorAll('.kuiz-option-btn');
                allOptionBtns.forEach(btn => btn.disabled = true);

                const isCorrect = clickedBtn.dataset.correct === 'true';

                if (isCorrect) {
                    clickedBtn.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                    clickedBtn.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    feedbackEl.textContent = "Jawapan Betul!";
                    feedbackEl.className = 'mt-4 p-4 rounded-lg font-medium text-center bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200';
                } else {
                    clickedBtn.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                    clickedBtn.classList.add('bg-red-500', 'text-white', 'border-red-500');
                    feedbackEl.textContent = "Jawapan Salah.";
                    feedbackEl.className = 'mt-4 p-4 rounded-lg font-medium text-center bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200';
                    // Highlight the correct answer
                    const correctBtn = optionsContainer.querySelector('[data-correct="true"]');
                    if(correctBtn) {
                        correctBtn.classList.add('bg-green-500', 'text-white', 'border-green-500');
                    }
                }
                feedbackEl.classList.remove('hidden');
                nextBtn.classList.remove('hidden');
            });

            nextBtn.addEventListener('click', () => {
                // In a real app, you would load the next question here.
                // For this UI demo, we just reset the current question view.
                resetKuizUI();
            });
        }
        
        // Tab switching logic for Nota page
        const tabLinks = document.querySelectorAll('.tab-link');
        const tabContents = document.querySelectorAll('.tab-content');
        tabLinks.forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const tabId = link.dataset.tab;

                tabLinks.forEach(l => {
                    l.classList.remove('border-teal-500', 'text-teal-600');
                    l.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                });
                link.classList.add('border-teal-500', 'text-teal-600');
                link.classList.remove('border-transparent', 'text-gray-500');

                tabContents.forEach(content => {
                    if (content.id === tabId) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
            });
        });

        // --- Embed Page Logic ---
        function showEmbedPage(url) {
            const embedUrl = url.includes('?') ? `${url}&rm=minimal` : `${url}?rm=minimal`;
            document.getElementById('embed-frame').src = embedUrl;
            showPage('embed');
        }
        
        // --- Waktu Solat Logic (JAKIM e-Solat API) ---
        const solatZones = {
            "JOHOR": { "JHR01": "Pulau Aur dan Pulau Pemanggil", "JHR02": "Johor Bahru, Kota Tinggi, Kulai, Pulau Tioman", "JHR03": "Kluang, Mersing", "JHR04": "Batu Pahat, Muar, Segamat, Gemas, Pontian" },
            "KEDAH": { "KDH01": "Kota Setar, Kubang Pasu, Pokok Sena (Daerah Kecil)", "KDH02": "Kuala Muda, Yan, Pendang", "KDH03": "Padang Terap, Sik", "KDH04": "Baling", "KDH05": "Kulim, Bandar Baharu", "KDH06": "Langkawi", "KDH07": "Puncak Gunung Jerai" },
            "KELANTAN": { "KTN01": "Bachok, Kota Bharu, Machang, Pasir Mas, Pasir Puteh, Tanah Merah, Tumpat, Kuala Krai, Mukim Chiku", "KTN03": "Gua Musang (Daerah Galas Dan Bertam), Jeli" },
            "MELAKA": { "MLK01": "Seluruh Negeri Melaka" },
            "NEGERI SEMBILAN": { "NGS01": "Tampin, Jempol", "NGS02": "Jelebu, Kuala Pilah, Port Dickson, Rembau, Seremban" },
            "PAHANG": { "PHG01": "Pulau Tioman", "PHG02": "Kuantan, Pekan, Rompin, Muadzam Shah", "PHG03": "Jerantut, Temerloh, Maran, Bera, Chenor, Jengka", "PHG04": "Bentong, Lipis, Raub", "PHG05": "Genting Sempah, Janda Baik, Bukit Tinggi", "PHG06": "Cameron Highlands, Genting Highlands, Bukit Fraser" },
            "PERAK": { "PRK01": "Tapah, Slim River, Tanjung Malim", "PRK02": "Kuala Kangsar, Sg. Siput, Ipoh, Batu Gajah, Kampar", "PRK03": "Lenggong, Pengkalan Hulu, Grik", "PRK04": "Temengor, Belum", "PRK05": "Kg Gajah, Teluk Intan, Bagan Datuk, Seri Iskandar, Beruas, Parit, Lumut, Sitiawan, Pulau Pangkor", "PRK06": "Selama, Taiping, Bagan Serai, Parit Buntar", "PRK07": "Bukit Larut" },
            "PERLIS": { "PLS01": "Seluruh Negeri Perlis" },
            "PULAU PINANG": { "PNG01": "Seluruh Negeri Pulau Pinang" },
            "SABAH": { "SBH01": "Bahagian Sandakan (Timur), Bukit Garam, Semawang, Temanggong, Tambisan, Bandar Sandakan, Sukau", "SBH02": "Beluran, Telupid, Pinangah, Terusan, Kuamut, Bahagian Sandakan (Barat)", "SBH03": "Lahad Datu, Silabukan, Kunak, Sahabat, Semporna, Tungku", "SBH04": "Tawau, Balung, Merotai, Kalabakan", "SBH05": "Kudat, Kota Marudu, Pitas, Pulau Banggi", "SBH06": "Gunung Kinabalu", "SBH07": "Kota Kinabalu, Tuaran, Ranau, Kota Belud, Penampang, Papar, Putatan", "SBH08": "Pensiangan, Keningau, Tambunan, Nabawan", "SBH09": "Beaufort, Kuala Penyu, Sipitang, Tenom, Long Pa Sia, Membakut, Weston" },
            "SARAWAK": { "SWK01": "Limbang, Lawas, Sundar, Trusan", "SWK02": "Miri, Niah, Bekenu, Sibuti, Marudi", "SWK03": "Pandan, Belaga, Suai, Tatau, Sebauh, Bintulu", "SWK04": "Sibu, Kanowit, Dalat, Oya, Kapit, Belaga, Song", "SWK05": "Mukah, Igan, Oya, Balingian, Daro, Matu", "SWK06": "Sarikei, Meradong, Julau, Pakan, Tanjung Manis", "SWK07": "Serian, Simunjan, Samarahan, Sebuyau, Meludam", "SWK08": "Sri Aman, Lubok Antu, Engkilili, Lingga, Pantu, Betong, Spaoh, Debak", "SWK09": "Kuching, Bau, Lundu, Sematan" },
            "SELANGOR": { "SGR01": "Hulu Selangor, Gombak, Petaling, Sepang, Hulu Langat", "SGR02": "Kuala Selangor, Sabak Bernam", "SGR03": "Klang, Kuala Langat" },
            "TERENGGANU": { "TRG01": "Kuala Terengganu, Marang, Kuala Nerus", "TRG02": "Besut, Setiu", "TRG03": "Hulu Terengganu", "TRG04": "Dungun, Kemaman" },
            "WILAYAH PERSEKUTUAN": { "WLY01": "Kuala Lumpur, Putrajaya", "WLY02": "Labuan" }
        };

        const negeriSelect = document.getElementById('solat-negeri');
        const kawasanSelect = document.getElementById('solat-kawasan');
        const solatResults = document.getElementById('solat-results');
        
        async function fetchJakimPrayerTimes(zone) {
            solatResults.innerHTML = '<p>Memuatkan waktu solat...</p>';
            stopCountdown();
            try {
                const response = await fetch(`https://www.e-solat.gov.my/index.php?r=esolatApi/TakwimSolat&period=today&zone=${zone}`);
                if (!response.ok) throw new Error('Gagal mendapatkan data dari e-Solat JAKIM.');
                const data = await response.json();
                
                if (data.prayerTime && data.prayerTime.length > 0) {
                    const times = data.prayerTime[0];
                    prayerTimesToday = times; // Store the full data for countdown

                    solatResults.innerHTML = `
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-2 text-sm">
                            <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded"><strong>Imsak:</strong> ${times.imsak.substring(0, 5)}</div>
                            <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded"><strong>Subuh:</strong> ${times.fajr.substring(0, 5)}</div>
                            <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded"><strong>Syuruk:</strong> ${times.syuruk.substring(0, 5)}</div>
                            <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded"><strong>Zohor:</strong> ${times.dhuhr.substring(0, 5)}</div>
                            <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded"><strong>Asar:</strong> ${times.asr.substring(0, 5)}</div>
                            <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded"><strong>Maghrib:</strong> ${times.maghrib.substring(0, 5)}</div>
                            <div class="p-2 bg-gray-200 dark:bg-gray-600 rounded"><strong>Isyak:</strong> ${times.isha.substring(0, 5)}</div>
                        </div>
                        <div id="solat-info-footer" class="mt-4 text-center text-sm">
                            <p class="font-semibold">Menuju <span id="next-prayer-name">--</span>: <span id="prayer-countdown-timer">--:--:--</span></p>
                            <p class="text-gray-500 dark:text-gray-400"><span id="masihi-date">${times.date}</span> | <span id="hijri-date">${times.hijri}</span></p>
                        </div>
                    `;
                    startCountdown(); // Start the countdown with new data
                } else {
                    throw new Error('Tiada data waktu solat ditemui untuk zon ini.');
                }
            } catch (error) {
                solatResults.innerHTML = `<p class="text-red-500">${error.message}</p>`;
            }
        }
        
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            updateCountdown(); // Update immediately
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function stopCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            document.getElementById('header-countdown').classList.add('hidden');
        }

        function updateCountdown() {
            if (!prayerTimesToday) return;

            const now = new Date();
            const prayerOrder = [
                { name: 'Subuh', time: prayerTimesToday.fajr },
                { name: 'Syuruk', time: prayerTimesToday.syuruk },
                { name: 'Zohor', time: prayerTimesToday.dhuhr },
                { name: 'Asar', time: prayerTimesToday.asr },
                { name: 'Maghrib', time: prayerTimesToday.maghrib },
                { name: 'Isyak', time: prayerTimesToday.isha }
            ];

            let nextPrayer = null;

            // Find the next prayer for today
            for (const prayer of prayerOrder) {
                const prayerTime = new Date();
                const [hours, minutes, seconds] = prayer.time.split(':');
                prayerTime.setHours(parseInt(hours), parseInt(minutes), parseInt(seconds), 0);
                if (prayerTime > now) {
                    nextPrayer = { name: prayer.name, time: prayerTime };
                    break;
                }
            }

            // If all prayers for today are over, the next is Fajr tomorrow
            if (!nextPrayer) {
                const fajrTomorrow = new Date();
                const [hours, minutes, seconds] = prayerTimesToday.fajr.split(':');
                fajrTomorrow.setDate(fajrTomorrow.getDate() + 1);
                fajrTomorrow.setHours(parseInt(hours), parseInt(minutes), parseInt(seconds), 0);
                nextPrayer = { name: 'Subuh', time: fajrTomorrow };
            }

            const diff = nextPrayer.time - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            const formattedCountdown = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            // Update UI elements if they exist
            const nextPrayerNameEl = document.getElementById('next-prayer-name');
            const prayerCountdownTimerEl = document.getElementById('prayer-countdown-timer');
            const headerCountdownTimerEl = document.getElementById('header-countdown-timer');
            
            if (nextPrayerNameEl) nextPrayerNameEl.textContent = nextPrayer.name;
            if (prayerCountdownTimerEl) prayerCountdownTimerEl.textContent = formattedCountdown;
            if (headerCountdownTimerEl) headerCountdownTimerEl.textContent = formattedCountdown;

            document.getElementById('header-countdown').classList.remove('hidden');
        }

        function populateNegeri() {
            Object.keys(solatZones).forEach(negeri => {
                const option = document.createElement('option');
                option.value = negeri;
                option.textContent = negeri.charAt(0).toUpperCase() + negeri.slice(1).toLowerCase();
                negeriSelect.appendChild(option);
            });
        }

        negeriSelect.addEventListener('change', () => {
            const selectedNegeri = negeriSelect.value;
            kawasanSelect.innerHTML = '<option>Pilih Kawasan</option>';
            solatResults.innerHTML = 'Sila pilih kawasan.';
            if (solatZones[selectedNegeri]) {
                Object.entries(solatZones[selectedNegeri]).forEach(([code, name]) => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = name;
                    kawasanSelect.appendChild(option);
                });
            }
        });

        kawasanSelect.addEventListener('change', () => {
            const zone = kawasanSelect.value;
            if (!zone || zone === "Pilih Kawasan") return;
            fetchJakimPrayerTimes(zone);
        });
        
        function setInitialPrayerTime() {
            const defaultNegeri = "SARAWAK";
            const defaultKawasan = "SWK07"; // Samarahan

            negeriSelect.value = defaultNegeri;
            
            // Manually trigger change to populate kawasan
            negeriSelect.dispatchEvent(new Event('change')); 
            
            kawasanSelect.value = defaultKawasan;
            
            // Manually trigger change to fetch data
            kawasanSelect.dispatchEvent(new Event('change'));
        }

        // --- Pop-up Modal Logic ---
        const popupModal = document.getElementById('popup-modal');
        const popupTitle = document.getElementById('popup-title');
        const popupMessage = document.getElementById('popup-message');
        const popupClose = document.getElementById('popup-close');

        function showPopup(title, message) {
            popupTitle.textContent = title;
            popupMessage.textContent = message;
            popupModal.classList.remove('hidden');
        }

        popupClose.addEventListener('click', () => {
            popupModal.classList.add('hidden');
        });

        // --- Initial Setup ---
        // Function to run after the DOM is fully loaded
        function initializeApp() {
            renderIcons(); // Initial icon render
            setupKuizInteraction(); // Setup quiz button listeners
            populateNegeri();
            setInitialPrayerTime();

            menuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
    </script>
</body>
</html>

